<!DOCTYPE html>
<html>
<script>

function window_onload() {
    if (!IsAdmin()) {
        Elevate();
    } else {
        checkdomain()
    }
}

function IsAdmin() {
    try {
        var shell = new ActiveXObject("WScript.Shell");
        shell.RegRead("HKU\\S-1-5-19\\Environment\\TEMP");
        return true;
    } catch (e) {
        return false;
    }
}

function Elevate() {
    var shellApp = new ActiveXObject("Shell.Application");
    var fullPath = document.location.href;
    fullPath = unescape(fullPath);
	alert("mshta.exe " + '"' + fullPath + '"')
    shellApp.ShellExecute(
        "mshta.exe",
        '"' + fullPath + '"',
        "",
        "runas",
        1
    );

    window.close();
}
window.onload = window_onload
</script>

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>CollabVM Toolkit (Online)</title>
	<style>
		* {
			margin: 0;
		}

		.actions {
			align-items: center;
			text-align: center;
			background-color: rgb(158, 255, 155);
			padding-bottom: 2.5%;
			padding-top: 2.5%;

			h1 {
				padding-bottom: 2%;
			}

			button {
				margin-left: 1%;
			}

			button:disabled {
				background-color: gray;
			}

		}

		;
	</style>
	<script>
		function setReg(path, type, value) {
			var shell = new ActiveXObject("WScript.Shell");
			shell.RegWrite(path, value, type);
		}

		function DemoteFromActiveDirectory() {
			try {
				var strComputer = ".";
				var network = new ActiveXObject("WScript.Network");
				var strUser = network.ComputerName;
				var locator = new ActiveXObject("WbemScripting.SWbemLocator");
				var service = locator.ConnectServer(strComputer, "root\\cimv2");
				var systems = service.ExecQuery("Select * from Win32_ComputerSystem");
				var e = new Enumerator(systems);
				for (; !e.atEnd(); e.moveNext()) {
					var computer = e.item();
					alert("Attempting to leave domain...")
					var result = computer.UnjoinDomainOrWorkgroup("", strUser, 0);
					if (result == 5) {
						alert("Please run as admin and try again. (ERROR_ACCESS_DENIED)")
					} else if (result == 0) {
						alert("Left domain! Please logout to continue!")
					} else if (result == 2695) {
						alert("Big error please reboot (NERR_InvalidWorkgroupName)")
					} else {
						alert("Error: " + result)
					}
				}
			} catch (err) {
				alert(err)
			}
		}
		function RemoveLanSchool() {
			var shell = new ActiveXObject("WScript.Shell");
			try {
				shell.Run("taskkill /f /im student.exe", 0, true);
				shell.Run('takeown /F "C:\\Program Files (x86)\\LanSchool" /R /D Y', 0, true);
				shell.Run('icacls "C:\\Program Files (x86)\\LanSchool" /grant EVERYONE:(WDAC)', 0, true);
				shell.Run('RD "C:\\Program Files (x86)\\LanSchool" /S /Q', 0, true);
				alert("Done!")
			} catch (err) {
				alert("Error: " + err)
			}
		}
		function extradisable() {
			var ex = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\";
			var dr = ex + "DisallowRun\\";
			setReg(ex + "NoUserMgr", "REG_DWORD", 1);
			setReg(dr + "1", "REG_SZ", "mmc.exe");
			setReg(dr + "2", "REG_SZ", "regedit.exe");
			setReg(dr + "3", "REG_SZ", "control.exe");
		}

		function DisablePowerOptions() {
			var ex = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\";
			var sys = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\";
			setReg(sys + "DisableLockWorkstation", "REG_DWORD", 1);
			setReg(sys + "DisableChangePassword", "REG_DWORD", 1);
			setReg("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Power\\HibernateEnabled", "REG_DWORD", 0);
			setReg("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Power\\CsEnabled", "REG_DWORD", 0);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\NoLogOff", "REG_DWORD", 1);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\NoClose", "REG_DWORD", 1);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\NoSwitchUser", "REG_DWORD", 1);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableLockWorkstation", "REG_DWORD", 1);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoLogoff", "REG_DWORD", 1);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoClose", "REG_DWORD", 1);
			setReg("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoPowerOptions", "REG_DWORD", 1);
			setReg("HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ShutdownWithoutLogon", "REG_DWORD", 1);
			setReg("HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\HideFastUserSwitching", "REG_DWORD", 1);
			setReg("HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableCAD", "REG_DWORD", 1);
		}

		function BkgLockout() {
			var ad = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\ActiveDesktop\\";
			var ex = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\";
			var sys = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\";
			var themeKey = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize\\";
			var persCU = "HKCU\\Software\\Policies\\Microsoft\\Windows\\Personalization\\";
			setReg(ex + "NoDesktop", "REG_DWORD", 0);
			setReg(ex + "NoThemesTab", "REG_DWORD", 1);
			setReg(ex + "NoControlPanel", "REG_DWORD", 1);
			setReg(ad + "NoChangingWallPaper", "REG_DWORD", 1);
			setReg(ad + "NoAddingComponents", "REG_DWORD", 1);
			setReg(ad + "NoDeletingComponents", "REG_DWORD", 1);
			setReg(ad + "NoComponents", "REG_DWORD", 0);
			setReg(sys + "Wallpaper", "REG_SZ", "C:\\Windows\\Web\\Wallpaper\\Windows\\img0.jpg");
			setReg(sys + "NoColorChoice", "REG_DWORD", 1);
			setReg(sys + "NoVisualStyleChoice", "REG_DWORD", 1);
			setReg(sys + "NoDispBackgroundPage", "REG_DWORD", 1);
			setReg(sys + "NoDispAppearancePage", "REG_DWORD", 1);
			setReg(sys + "NoDispSettingsPage", "REG_DWORD", 1);
			setReg(sys + "NoDispScrSavPage", "REG_DWORD", 1);
			setReg(sys + "NoSizeChoice", "REG_DWORD", 1);
			setReg(persCU + "NoChangingColor", "REG_DWORD", 1);
			setReg(persCU + "NoChangingMousePointers", "REG_DWORD", 1);
			setReg(persCU + "NoChangingTheme", "REG_DWORD", 1);
			setReg(persCU + "NoChangingStartMenuBackground", "REG_DWORD", 1);
			setReg(themeKey + "SystemUsesLightTheme", "REG_DWORD", 1);
			setReg(themeKey + "AppsUseLightTheme", "REG_DWORD", 1);
			setReg(themeKey + "ColorPrevalence", "REG_DWORD", 1);
			setReg("HKCU\\Control Panel\\Desktop\\TileWallpaper", "REG_SZ", "0");
			setReg("HKCU\\Control Panel\\Desktop\\WallpaperStyle", "REG_SZ", "2");
			setReg("HKCU\\Software\\Policies\\Microsoft\\Windows\\Explorer\\NoPinningToTaskbar", "REG_DWORD", 1);
			setReg("HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\SettingsPageVisibility", "REG_SZ", "hide:personalization");
			setReg("HKCU\\Software\\Microsoft\\Windows\\DWM\\ColorizationColor", "REG_DWORD", 436207616);
			setReg("HKCU\\Software\\Microsoft\\Windows\\DWM\\ColorizationColorBalance", "REG_DWORD", 100);
		}
	</script>
	<script>
		function checkdomain() {
			var locator = new ActiveXObject("WbemScripting.SWbemLocator"); // create WMI locator
			var service = locator.ConnectServer(".", "root\\cimv2");       // connect to local WMI namespace

			var query = "SELECT PartOfDomain, Domain FROM Win32_ComputerSystem";
			var colItems = service.ExecQuery(query);

			var e = new Enumerator(colItems);
			for (; !e.atEnd(); e.moveNext()) {
				var item = e.item();
				if (item.PartOfDomain) {
					alert("You are in a domain! Click Demote from windows Domain!");
				} else {
					document.querySelectorAll('#demotead')[0].setAttribute("disabled", "true")
					document.querySelectorAll('#BkgLockout')[0].removeAttribute("disabled")
					document.querySelectorAll('#LeaveLanSchool')[0].removeAttribute("disabled")
					document.querySelectorAll('#dispwroption')[0].removeAttribute("disabled")
					//document.querySelectorAll('#rewindpol')[0].removeAttribute("disabled")
				}
			}
		}
		window.onload = checkdomain
	</script>
</head>

<body>
	<div class="actions">
		<h1>CollabVM ToolKit</h1>
		<button id="demotead" onclick="DemoteFromActiveDirectory()">Demote from Windows Domain</button>
		<button id="BkgLockout" onclick="BkgLockout()" disabled="">Launch BkgLockout</button>
		<button id="LeaveLanSchool" onclick="RemoveLanSchool()" disabled="">Remove LanSchool</button><br>
		<button id="dispwroption" onclick="DisablePowerOptions()" disabled="">Disable Power Options</button>
		<button id="rewindpol" disabled="">TODO: Remove policy</button>
	</div><br>
	<p>Made by initgoatfs<br>
		<button disabled="">TODO: Download to your CollabUSB or CollabFloppy</button>
</body>

</html>
