<html>
<head>
    <title>Legacy Policy Lockdown</title>
    <HTA:APPLICATION
      ID="oHTA"
      APPLICATIONNAME="HiddenApp"
      WINDOWSTATE="minimize"
      SHOWINTASKBAR="no"
      CAPTION="no"
      BORDER="none"
      SYSMENU="no"
      MAXIMIZEBUTTON="no"
      MINIMIZEBUTTON="no"
   >

    <script language="JScript">
        function setReg(path, value, type) {
            var shell = new ActiveXObject("WScript.Shell");
            shell.RegWrite(path, value, type);
        }

        function run() {
            try {
                var ad = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\ActiveDesktop\\";
                setReg(ad + "NoChangingWallPaper", 1, "REG_DWORD");
                setReg(ad + "NoAddingComponents", 1, "REG_DWORD");
                setReg(ad + "NoDeletingComponents", 1, "REG_DWORD");
                setReg(ad + "NoComponents", 1, "REG_DWORD");

                var ex = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\";
                setReg(ex + "NoDriveTypeAutoRun", 91, "REG_DWORD");
                setReg(ex + "NoActiveDesktopChanges", 1, "REG_DWORD");
                setReg(ex + "NoThemesTab", 1, "REG_DWORD");
                setReg(ex + "NoSimpleStartMenu", 1, "REG_DWORD");
                setReg(ex + "NoSearchInternetInStartMenu", 1, "REG_DWORD");
                setReg(ex + "ForceRunOnStartMenu", 1, "REG_DWORD");
                setReg(ex + "NoControlPanel", 1, "REG_DWORD");

                var prog = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Programs\\";
                setReg(prog + "NoGetPrograms", 1, "REG_DWORD");
                setReg(prog + "NoInstalledUpdates", 1, "REG_DWORD");
                setReg(prog + "NoWindowsMarketplace", 1, "REG_DWORD");

                var sys = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\";
                setReg(sys + "Wallpaper", "C:\\Windows\\Web\\Wallpaper\\Windows\\img0.jpg", "REG_SZ");
                setReg(sys + "WallpaperStyle", "0", "REG_SZ");
                setReg(sys + "NoColorChoice", 1, "REG_DWORD");
                setReg(sys + "NoVisualStyleChoice", 1, "REG_DWORD");
                setReg(sys + "NoDispBackgroundPage", 1, "REG_DWORD");
                setReg(sys + "NoDispAppearancePage", 1, "REG_DWORD");
                setReg(sys + "NoDispSettingsPage", 1, "REG_DWORD");
                setReg(sys + "NoDispScrSavPage", 1, "REG_DWORD");
                setReg(sys + "NoSizeChoice", 1, "REG_DWORD");
                setReg(sys + "DisableLockWorkstation", 1, "REG_DWORD");
                setReg(sys + "DisableChangePassword", 1, "REG_DWORD");
                setReg("HKCU\\Software\\Policies\\Microsoft\\Windows\\Explorer\\NoPinningToTaskbar", 1, "REG_DWORD");
                var pers = "HKCU\\Software\\Policies\\Microsoft\\Windows\\Personalization\\";
                setReg(pers + "NoChangingMousePointers", 1, "REG_DWORD");
                setReg(pers + "NoChangingTheme", 1, "REG_DWORD");
                setReg(pers + "NoChangingColorScheme", 1, "REG_DWORD");
                setReg(pers + "NoChangingStartMenuBackground", 1, "REG_DWORD");
                var persLM = "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Personalization\\";
                setReg(persLM + "NoChangingLockScreen", 1, "REG_DWORD");
                setReg(persLM + "NoLockScreen", 1, "REG_DWORD");

                setReg("HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer\\HideRecentlyAddedApps", 1, "REG_DWORD");

                // DisallowRun
                var dis = ex + "DisallowRun\\";
                setReg(dis + "1", "mmc.exe", "REG_SZ");
                setReg(dis + "2", "regedit.exe", "REG_SZ");
                setReg(dis + "3", "control.exe", "REG_SZ");

                document.getElementById("status").innerText = "Done.";
                setTimeout(function(){ window.close(); }, 3000);

            } catch (e) {
                alert("Error: " + e.message);
            }
        }
    </script>
</head>

<body onload="run()" style="font-family:Segoe UI; padding:20px;">
    <div id="status">Working...</div>
</body>
</html>
